const t="colorScheme",e="colorLinearRange",r={getDropdown(t,e){if(t&&t.length>0)return t;const r=[];return e.forEach(((t,e)=>{0!==e&&(t=>"Color"!==t&&"keyCategory"!==t)(t)&&r.push({data:t,display:t})})),r},getId:t=>t.replace(/ |-|\(|\)/g,"_"),getColorDomainRangeMax(r){const a=t=>r&&r[t],n=Array.isArray(r[e]),o=a(e)?n?Object.values(r[e]):Object.keys(r[e]).map((t=>parseInt(t))):[],s=a(e)?n?[]:Object.values(r[e]):[],l=r[t],i=r.colorMax||d3.max(o);return{colorDomain:o.map((t=>t/i)),colorRange:s&&s.length>0?s:l,colorMax:i}},getUserDefinedKeysColors(t){const e=[],r=[];return t.forEach((t=>{e.push(t.key?t.key:t.keyName),r.push(t.colour)})),{keys:e,colors:r}},getKeysColors({keys:e,userKey:r,option:a}){let n={keys:e};return r.length>=1?n=this.getUserDefinedKeysColors(r):a[t]&&(n.colors=a[t]),n},chartlines:t=>0==t.dropdown.length?t.keys:[t.xColumn,...t.dropdown[0].values.split(",").map((t=>t.trim()))],stackedhorizontal:t=>0==t.dropdown.length?t.keys.filter((e=>e!=t.yColumn)):t.dropdown[0].values.split(",").map((t=>t.trim())),stackedbars:t=>0==t.dropdown.length?t.keys.filter((e=>e!=t.xColumn)):t.dropdown[0].values.split(",").map((t=>t.trim())),smallmultiples:t=>0==t.dropdown.length?t.keys:[t.xColumn,t.groupBy,...t.dropdown[0].values.split(",").map((t=>t.trim()))]};var a={guardian:["#CC0A11","#046DA1","#f28e2c","#76b7b2","#59a14f","#edc949","#af7aa1","#ff9da7","#9c755f","#bab0ab","#000000"],guardian2:["rgb(204, 10, 17)","rgb(4, 109, 161)","#ff7f00","rgb(0, 178, 255)","rgb(245, 189, 44)","rgb(179, 179, 180)","rgb(128, 128, 128)","#000000"]};class n{constructor(t){const e=a.guardian,r="string"==typeof t,n=e=>!t||r?null:t[e],o=t?r?t:t.type:"ordinal",s=n("domain"),l=n("colors");switch(this.divisor=n("divisor"),o){case"linear":this.cScale=d3.scaleLinear().range(e);break;case"threshold":this.cScale=d3.scaleThreshold().range(e);break;case"quantile":this.cScale=d3.scaleQuantile().range(e);break;case"quantize":this.cScale=d3.scaleQuantize().range(e);break;default:this.cScale=d3.scaleOrdinal().range(e)}this.set(s,l)}get(t){const e=this.divisor?t/this.divisor:t;return this.cScale(e)}set(t,e){let r=!1,n=null;"string"==typeof e&&(a[e]?(n=a[e],r=!0):d3[e]?(n=d3[e],r=!0):console.error(`${e} is not part of the color presets or d3 scale chromatic colour scheme`)),Array.isArray(e)&&e.length>0&&(n=e,r=!0),r&&this.cScale.range(n),t&&t.length>0&&this.cScale.domain(t)}}class o{constructor(t){this.settings=t,this.init()}init(){this.render()}render(){let{modules:t,type:e,colors:a,height:o,width:s,isMobile:l,title:i,subtitle:c,source:d,marginleft:u,margintop:p,marginbottom:g,marginright:h,tooltip:f,data:y,datum:m,labels:x,userkey:k,keys:b,enableShowMore:v,colorScheme:C,dropdown:w,groupBy:S,minX:M,maxX:A,xFormat:F}=this.settings;console.log(`xFormat: ${F}`);d3.select("#graphicContainer svg").remove();const O=d3.select("#chartKey");O.html(""),m=JSON.parse(JSON.stringify(y)),a=new n,l=Math.max(document.documentElement.clientWidth,window.innerWidth||0)<610;const T=r.getKeysColors({keys:b,userKey:k,option:{colorScheme:C}});a.set(T.keys,T.colors),s=document.querySelector("#graphicContainer").getBoundingClientRect().width,o=40*m.length+p+g,s-=h;let D=b.filter((t=>"Color"!=t&&t!=S)),K=[];for(var N=0;N<m.length;N++)D.forEach((t=>{K.push(m[N][t])}));let z=d3.extent(K);const B=function(t){let e=d3.extent(t),r=0,a=e[1],n=!1;return e[0]<0&&(e[0]=Math.floor(e[0]),e[1]=Math.ceil(e[1]),a=Math.abs(e[0])>e[1]?Math.abs(e[0]):e[1],r=-a,n=!0),{min:r,max:a,status:n}}(K.map((t=>t)));let E=function(t,e,r=5){const a=(e-t)/100*r;return[t-a,e+a]}(z[0],z[1],15);M=isNaN(M)?+M:E[0],A=isNaN(A)?+A:E[1];const R=d3.select("#graphicContainer").append("svg").attr("width",s).attr("height",o).attr("id","svg").attr("overflow","hidden"),U=R.append("g").attr("transform","translate("+u+","+p+")");var $=d3.scaleLinear();$.domain([M,A]).nice().range([0,s-h-u]),U.append("g").attr("transform","translate(0,"+o+")").call(d3.axisBottom($));var j=d3.scaleBand().range([0,o-p-g]).domain(m.map((function(t){return t[S]}))).padding(1);if(2==D.length){let t=a.get(D[0]),e=a.get(D[1]);U.selectAll("lines").data(m).enter().append("line").attr("x1",(function(t){return $(+t[D[0]])})).attr("x2",(function(t){return $(+t[D[1]])})).attr("y1",(function(t){return j(t[S])})).attr("y2",(function(t){return j(t[S])})).attr("stroke",(function(r,a){let n=$(+r[D[0]]),o=$(+r[D[1]]),s=n<o?t:e,l=o>n?e:t,i=n<o?n:o,c=o>n?o:n,d=R.append("defs").append("linearGradient").attr("id",`svgGradient_${a}`).attr("gradientUnits","userSpaceOnUse").attr("x1",i).attr("x2",c).attr("y1",j(r[S])).attr("y2",j(r[S])+10);return d.append("stop").attr("class","start").attr("offset","0%").attr("stop-color",s).attr("stop-opacity"),d.append("stop").attr("class","end").attr("offset","100%").attr("stop-color",l).attr("stop-opacity",1),`url(#svgGradient_${a})`})).style("stroke-width","6px")}1==D.length?(U.selectAll("lines").data(m).enter().append("line").attr("x1",(function(t){return $(0)})).attr("x2",(function(t){return $(+t[D[0]])})).attr("y1",(function(t){return j(t[S])})).attr("y2",(function(t){return j(t[S])})).style("stroke",((t,e)=>t.Color?t.Color:a.get(t[D[0]]))).style("stroke-width","4px"),U.selectAll(".barText").data(m).enter().append("text").attr("class","barText").attr("x",(function(t){let e=t[D[0]]<0?-6:6;return $(0)+e})).attr("text-anchor",(function(t){return t[D[0]]>0?"start":"end"})).attr("y",(function(t){return j(t[S])-40/3.5})).text((t=>t[S])),M<0&&A>0&&U.append("line").attr("x1",(function(t){return $(0)})).attr("x2",(function(t){return $(0)})).attr("y1",(function(t){return 0})).attr("y2",(function(t){return o})).style("stroke","#767676").style("stroke-width","1px")):U.selectAll(".barText").data(m).enter().append("text").attr("class","barText").attr("x",(function(t){let e=[];for(var r=0;r<D.length;r++)e.push(t[D[r]]);return $(d3.min(e))-20})).attr("text-anchor",(function(t){return B.status?"start":"end"})).attr("y",(function(t){return j(t[S])+3})).text((t=>t[S]));for(const t of D)U.selectAll(".lolly").data(m).enter().append("circle").attr("cx",(function(e){return $(+e[t])})).attr("cy",(function(t){return j(t[S])})).attr("r","7").style("fill",((e,r)=>e.Color?e.Color:a.get(t))).style("stroke",((e,r)=>e.Color?e.Color:a.get(t)));const q=function(t,e,r){if(t)return 4;let a=Math.round(e[1]-e[0]),n=Math.round(r/100);return console.log(a),n>a?a:n}(l,$.domain(),s);U.append("g").attr("class","x").attr("transform","translate(0,"+o+")").call((t=>t.attr("transform","translate(0,0)").attr("class","axisgroup").call(d3.axisTop($).tickSizeOuter(0)).call(d3.axisTop($).tickSize(-o,0,0).ticks(q).tickFormat((t=>function(t){if(t>0)return t>=1e9?t/1e9%1==0?t/1e9+"bn":(t/1e9).toFixed(1)+"bn":t>=1e6?t/1e6%1==0?t/1e6+"m":(t/1e6).toFixed(1)+"m":t>=1e3?t/1e3%1==0?t/1e3+"k":(t/1e3).toFixed(1)+"k":t;if(t<0){var e=-1*t;return e>=1e9?["-"+String((e/1e9).toFixed(1))+"bn"]:e>=1e6?["-"+String((e/1e6).toFixed(1))+"m"]:e>=1e3?["-"+String((e/1e3).toFixed(1))+"k"]:t}return t}(t))).tickPadding(10)))),D.length>1&&D.forEach(((t,e)=>{const r=O.append("div").attr("class","keyDiv");r.append("span").attr("class","keyCircle").style("background-color",(()=>a.get(t))),r.append("span").attr("class","keyText").text(t)})),(B.status||$(0)>u)&&U.append("line").style("stroke","#767676").style("stroke-width",1).attr("x1",$(0)).attr("y1",0).attr("x2",$(0)).attr("y2",o)}}export{o as default};
